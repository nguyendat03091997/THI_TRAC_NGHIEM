ALTER PROCEDURE [dbo].[SP_DANGNHAP] @TENLOGIN NVARCHAR (50), @MASV CHAR (8)
AS
BEGIN
DECLARE @TENUSER NVARCHAR(50), @TENNHOM NVARCHAR (10)
SELECT @TENUSER=NAME FROM sys.sysusers WHERE sid = SUSER_SID(@TENLOGIN)
SELECT @TENNHOM= NAME
  FROM sys.sysusers 
  WHERE UID = (SELECT GROUPUID 
               FROM SYS.SYSMEMBERS 
               WHERE MEMBERUID= (SELECT UID FROM sys.sysusers WHERE NAME=@TENUSER))

IF(@TENNHOM = 'Sinhvien') -- Login thuộc nhóm Sinhvien.
BEGIN

 SELECT USERNAME = MASV, 
  HOTEN = (SELECT HO + ' '+ TEN FROM SINHVIEN  WHERE MASV = @MASV ),
  TENNHOM = @TENNHOM
  FROM SINHVIEN
  WHERE MASV = @MASV

END
ELSE -- Login thuộc các nhóm còn lại.
BEGIN

 SELECT USERNAME = @TENUSER, 
  HOTEN = (SELECT HO + ' '+ TEN FROM GIAOVIEN  WHERE MAGV = @TENUSER ),
  TENNHOM= NAME
  FROM sys.sysusers 
  WHERE UID = (SELECT GROUPUID 
               FROM SYS.SYSMEMBERS 
               WHERE MEMBERUID= (SELECT UID FROM sys.sysusers WHERE NAME=@TENUSER))

END
END